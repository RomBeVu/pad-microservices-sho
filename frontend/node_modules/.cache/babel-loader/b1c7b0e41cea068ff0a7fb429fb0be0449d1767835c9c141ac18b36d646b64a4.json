{"ast":null,"code":"/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { millisToHrTime } from '@opentelemetry/core';\n/**\n * An internal opaque interface that the MetricReader receives as\n * MetricProducer. It acts as the storage key to the internal metric stream\n * state for each MetricReader.\n */\nexport class MetricCollector {\n  _sharedState;\n  _metricReader;\n  constructor(_sharedState, _metricReader) {\n    this._sharedState = _sharedState;\n    this._metricReader = _metricReader;\n  }\n  async collect(options) {\n    const collectionTime = millisToHrTime(Date.now());\n    const scopeMetrics = [];\n    const errors = [];\n    const meterCollectionPromises = Array.from(this._sharedState.meterSharedStates.values()).map(async meterSharedState => {\n      const current = await meterSharedState.collect(this, collectionTime, options);\n      // only add scope metrics if available\n      if (current?.scopeMetrics != null) {\n        scopeMetrics.push(current.scopeMetrics);\n      }\n      // only add errors if available\n      if (current?.errors != null) {\n        errors.push(...current.errors);\n      }\n    });\n    await Promise.all(meterCollectionPromises);\n    return {\n      resourceMetrics: {\n        resource: this._sharedState.resource,\n        scopeMetrics: scopeMetrics\n      },\n      errors: errors\n    };\n  }\n  /**\n   * Delegates for MetricReader.forceFlush.\n   */\n  async forceFlush(options) {\n    await this._metricReader.forceFlush(options);\n  }\n  /**\n   * Delegates for MetricReader.shutdown.\n   */\n  async shutdown(options) {\n    await this._metricReader.shutdown(options);\n  }\n  selectAggregationTemporality(instrumentType) {\n    return this._metricReader.selectAggregationTemporality(instrumentType);\n  }\n  selectAggregation(instrumentType) {\n    return this._metricReader.selectAggregation(instrumentType);\n  }\n  /**\n   * Select the cardinality limit for the given {@link InstrumentType} for this\n   * collector.\n   */\n  selectCardinalityLimit(instrumentType) {\n    return this._metricReader.selectCardinalityLimit?.(instrumentType) ?? 2000;\n  }\n}","map":{"version":3,"names":["millisToHrTime","MetricCollector","_sharedState","_metricReader","constructor","collect","options","collectionTime","Date","now","scopeMetrics","errors","meterCollectionPromises","Array","from","meterSharedStates","values","map","meterSharedState","current","push","Promise","all","resourceMetrics","resource","forceFlush","shutdown","selectAggregationTemporality","instrumentType","selectAggregation","selectCardinalityLimit"],"sources":["/home/senthilkumar/project/shopping-cart/frontend/node_modules/@opentelemetry/sdk-metrics/src/state/MetricCollector.ts"],"sourcesContent":["/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { millisToHrTime } from '@opentelemetry/core';\nimport { AggregationTemporalitySelector } from '../export/AggregationSelector';\nimport {\n  CollectionResult,\n  InstrumentType,\n  ScopeMetrics,\n} from '../export/MetricData';\nimport { MetricCollectOptions, MetricProducer } from '../export/MetricProducer';\nimport { IMetricReader } from '../export/MetricReader';\nimport { ForceFlushOptions, ShutdownOptions } from '../types';\nimport { MeterProviderSharedState } from './MeterProviderSharedState';\n\n/**\n * An internal opaque interface that the MetricReader receives as\n * MetricProducer. It acts as the storage key to the internal metric stream\n * state for each MetricReader.\n */\nexport class MetricCollector implements MetricProducer {\n  constructor(\n    private _sharedState: MeterProviderSharedState,\n    private _metricReader: IMetricReader\n  ) {}\n\n  async collect(options?: MetricCollectOptions): Promise<CollectionResult> {\n    const collectionTime = millisToHrTime(Date.now());\n    const scopeMetrics: ScopeMetrics[] = [];\n    const errors: unknown[] = [];\n\n    const meterCollectionPromises = Array.from(\n      this._sharedState.meterSharedStates.values()\n    ).map(async meterSharedState => {\n      const current = await meterSharedState.collect(\n        this,\n        collectionTime,\n        options\n      );\n\n      // only add scope metrics if available\n      if (current?.scopeMetrics != null) {\n        scopeMetrics.push(current.scopeMetrics);\n      }\n\n      // only add errors if available\n      if (current?.errors != null) {\n        errors.push(...current.errors);\n      }\n    });\n    await Promise.all(meterCollectionPromises);\n\n    return {\n      resourceMetrics: {\n        resource: this._sharedState.resource,\n        scopeMetrics: scopeMetrics,\n      },\n      errors: errors,\n    };\n  }\n\n  /**\n   * Delegates for MetricReader.forceFlush.\n   */\n  async forceFlush(options?: ForceFlushOptions): Promise<void> {\n    await this._metricReader.forceFlush(options);\n  }\n\n  /**\n   * Delegates for MetricReader.shutdown.\n   */\n  async shutdown(options?: ShutdownOptions): Promise<void> {\n    await this._metricReader.shutdown(options);\n  }\n\n  selectAggregationTemporality(instrumentType: InstrumentType) {\n    return this._metricReader.selectAggregationTemporality(instrumentType);\n  }\n\n  selectAggregation(instrumentType: InstrumentType) {\n    return this._metricReader.selectAggregation(instrumentType);\n  }\n\n  /**\n   * Select the cardinality limit for the given {@link InstrumentType} for this\n   * collector.\n   */\n  selectCardinalityLimit(instrumentType: InstrumentType): number {\n    return this._metricReader.selectCardinalityLimit?.(instrumentType) ?? 2000;\n  }\n}\n\n/**\n * An internal interface for MetricCollector. Exposes the necessary\n * information for metric collection.\n */\nexport interface MetricCollectorHandle {\n  selectAggregationTemporality: AggregationTemporalitySelector;\n  selectCardinalityLimit(instrumentType: InstrumentType): number;\n}\n"],"mappings":"AAAA;;;;;;;;;;;;;;;AAgBA,SAASA,cAAc,QAAQ,qBAAqB;AAYpD;;;;;AAKA,OAAM,MAAOC,eAAe;EAEhBC,YAAA;EACAC,aAAA;EAFVC,YACUF,YAAsC,EACtCC,aAA4B;IAD5B,KAAAD,YAAY,GAAZA,YAAY;IACZ,KAAAC,aAAa,GAAbA,aAAa;EACpB;EAEH,MAAME,OAAOA,CAACC,OAA8B;IAC1C,MAAMC,cAAc,GAAGP,cAAc,CAACQ,IAAI,CAACC,GAAG,EAAE,CAAC;IACjD,MAAMC,YAAY,GAAmB,EAAE;IACvC,MAAMC,MAAM,GAAc,EAAE;IAE5B,MAAMC,uBAAuB,GAAGC,KAAK,CAACC,IAAI,CACxC,IAAI,CAACZ,YAAY,CAACa,iBAAiB,CAACC,MAAM,EAAE,CAC7C,CAACC,GAAG,CAAC,MAAMC,gBAAgB,IAAG;MAC7B,MAAMC,OAAO,GAAG,MAAMD,gBAAgB,CAACb,OAAO,CAC5C,IAAI,EACJE,cAAc,EACdD,OAAO,CACR;MAED;MACA,IAAIa,OAAO,EAAET,YAAY,IAAI,IAAI,EAAE;QACjCA,YAAY,CAACU,IAAI,CAACD,OAAO,CAACT,YAAY,CAAC;;MAGzC;MACA,IAAIS,OAAO,EAAER,MAAM,IAAI,IAAI,EAAE;QAC3BA,MAAM,CAACS,IAAI,CAAC,GAAGD,OAAO,CAACR,MAAM,CAAC;;IAElC,CAAC,CAAC;IACF,MAAMU,OAAO,CAACC,GAAG,CAACV,uBAAuB,CAAC;IAE1C,OAAO;MACLW,eAAe,EAAE;QACfC,QAAQ,EAAE,IAAI,CAACtB,YAAY,CAACsB,QAAQ;QACpCd,YAAY,EAAEA;OACf;MACDC,MAAM,EAAEA;KACT;EACH;EAEA;;;EAGA,MAAMc,UAAUA,CAACnB,OAA2B;IAC1C,MAAM,IAAI,CAACH,aAAa,CAACsB,UAAU,CAACnB,OAAO,CAAC;EAC9C;EAEA;;;EAGA,MAAMoB,QAAQA,CAACpB,OAAyB;IACtC,MAAM,IAAI,CAACH,aAAa,CAACuB,QAAQ,CAACpB,OAAO,CAAC;EAC5C;EAEAqB,4BAA4BA,CAACC,cAA8B;IACzD,OAAO,IAAI,CAACzB,aAAa,CAACwB,4BAA4B,CAACC,cAAc,CAAC;EACxE;EAEAC,iBAAiBA,CAACD,cAA8B;IAC9C,OAAO,IAAI,CAACzB,aAAa,CAAC0B,iBAAiB,CAACD,cAAc,CAAC;EAC7D;EAEA;;;;EAIAE,sBAAsBA,CAACF,cAA8B;IACnD,OAAO,IAAI,CAACzB,aAAa,CAAC2B,sBAAsB,GAAGF,cAAc,CAAC,IAAI,IAAI;EAC5E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}